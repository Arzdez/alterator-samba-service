# Alterator samba service

### Методы интерфейса

- Info;
- Deploy;
- Undeploy;
- Backup;
- Restore;
- Status.

### Варианты сервисов

1. Файловый сервер
2. Контроллер домена
3. Сервер DHCP
4. Сервер DNS
5. Сервер FTP
6. Почтовый сервер
7. Сервер сетевой установки
8. Сервер FreeNX
9. Сервер видеоконференций
10. Сервер OpenUDS

### Описание сущности .service

Описание сервиса содержит в себе ключи:

- Type - обязательный;
- icon - опциональный
- name - обязательный;
- category - обязательный;
- comment - опицональный.

В нём описаны поля актуальные для настройки большинства сервисов:

#### parameters

[parameters.someParamName]
- display_name - обязательный;
- comment - опциональный;
- context - обязательный;
- type - тип принимаемого значения обазательный; 
   - int
   - string
   - enum - перечисление возможных значений параметра.
- value = ["value1", "value2", "value3"] - опциональный, использует в случае если type = enum.

Данные поля предназначены для ввода параметров деплоя/восстановления/бэкапа.

#### resources

[resources.someResourceName]  
- display_name - обязательный;
- comment - опциональный;
- type = Directory | File | Ports| systemd_units - обязательный
- path  - опицональный если type = Directory | File;
- ports - опциональный если type = Ports;
- unit - опциональный если type = systemd_units.

Расположение ресурсов сервиса: директории, конфиги и порты и управляющие юниты.

#### Контекст отображения

Для каждого поля предусмотрен контекст применения/отображения параметра:
- context - контекст отображения того или иного параметра; 
   - deploy - параметры нужные для деплоя сервиса;
   - status - вкладка со статусом;
   - backup - конфигурации политики бэкапирования;
   - restore - восстановление сервиса;
   - diag - возможно использование как пометку о важности данного параметра для преддиагностики и передачу его в diag.

Описание:

**deploy** - вкладка со всеми параметрами необходимыми для деплоя сервиса. Параметры заданные при деплое можно сохранять в dconf. Возвращает exit code и параметры с которыми он развернулся, в случае ошибки возвращает текст ошибки.

**status** - вывод актуального состояния сервиса на данный момент.

**backup** - тут предполагается указывать то где хранить бэкапы и что в целом бэкапить. В целом можно обойтись ресурсами и из них вытаскивать то что бэкапить, на первое время. Если у сервиса есть штатные средства то для него может потребоваться передовать параметры бэкапирования. Это одноразовая операция, т.е вызвали метод и забэкапили, пока обоходимся без расписаний и прочего.

**restore** - восстановление сервиса из бэкапа. Принимает в себя строку с параметрами для восстановления. Для некоторых сервисов возможно будет необязательным передавать какие-либо параметры. Возвращает результат восстановления и параметры с которыми он развернулся, в случае ошибки возвращает текст ошибки.

Для **undeploy** в общем случае какие-либо параметры не нужны. Не принимает в себя ничего и возвращает только код завершения.

### Дополнительно

Для **преддиагностики** предлагается наличие "галочки" или чего-то похожего для включения/выключения тестов в окне деплоя и дополнительно активна она или нет определять по наличию диага для данного сервиса. И в целом оптимальнее запрашивать у диага то, какие параметры нужны для предпроверки, а не помечать их.

Информацию о том с какими параметрами был развёрнут сервис предлагается хранить в dconf. Однако, при отображении  текущего статуса информацию можно пробовать парсить из файлов конфигурации, так как администраторы спокойно могут их изменить руками и dconf в данном случае будет служить архивом того как оно было изначально.

**Остаётся вопрос** определения того развёрнут ли уже сервис и если да, то в каком режиме, на каких портах, изменялось ли расположение конфигов и прочее. Для разных сервисов тут будт своя, местами, достаточно сложная эвристика.
