# Alterator samba service

### Методы интерфейса

- Info;
- Deploy;
- Undeploy;
- Backup;
- Restore;
- Status.

### Варианты сервисов

1. Файловый сервер
2. Контроллер домена
3. Сервер DHCP
4. Сервер DNS
5. Сервер FTP
6. Почтовый сервер
7. Сервер сетевой установки
8. Сервер FreeNX
9. Сервер видеоконференций
10. Сервер OpenUDS

### Описание сущности .service

Описание сервиса содержит в себе ключи:

- Type - обязательный;
- icon - опциональный
- name - обязательный;
- category - обязательный;
- comment - опицональный.

В нём описаны поля актуальные для настройки большинства сервисов:

#### parameters

[parameters.someParamName]
- display_name - обязательный;
- comment - опциональный;
- context - обязательный;
- type - тип принимаемого значения обазательный; 
   - int
   - string
   - enum - перечисление возможных значений параметра.
- values = ["value1", "value2", "value3"]

Данные поля предназначены для ввода параметров деплоя/восстановления/бэкапа.  

#### resources

[resources.someResourceName]  

- display_name - обязательный;
- comment - опциональный;
- context - обязательный;
- type = Directory|File - обязательный
- path - обязательный.

Расположение ресурсов сервиса: директории, конфиги и прочее.  

#### services

[services.someServiceName]
- display_name - обязательный;
- comment - опциональный;
- context - обязательный;
- type = unit - обязательный;
- unit_name - обязательный.

Управляющие systemd юниты.

#### ports  
[ports.anyPort]  
- display_name - обязательный;
- comment - опциональный;
- type = port - обязательный
- port = "" - обязательный

Порты на которых работают компоненты сервиса. Ряд сервисов поддерживает их смену и запуск инстансов на разных портах.

#### Контекст отображения

Для каждого поля предусмотрен контекст применения/отображения параметра:

- context - контекст отображения того или иного параметра; 

   - deploy - параметры нужные для деплоя сервиса;
   - status - вкладка со статусом;
   - backup - конфигурации политики бэкапирования;
   - restore - восстановление сервиса;
   - diag - возможно использование как пометку о важности данного параметра для преддиагностики;

Описание:

**deploy** - вкладка со всеми параметрами необходимыми для деплоя сервиса.

**status** - вывод актуального состояния сервиса на данный момент. Предлагается в него, помимо текущей информации о конфигурации и параметров с которыми сервис был запущен, возвращать ещё некоторые диагностические данные актуальные для мониторинга, например потребление управляющими сервисами памяти, колличества обращений клиентов и прочие. Эту тему предлагаю дополнительно обсудить, так как в будущем можно будет подумать на тему опции мониторинга - выбрал и вместе с сервисом мониторинг развернулся.

**backup** - тут предполагается указывать то где хранить бэкапы и как минимум их ротацию и периодичность.

**restore** - восстановление сервиса из бэкапа.  

Для **undeploy** в общем случае какие-либо параметры не нужны, однако можно добавить что-то типа места куда сохранить текущую конфигурацию сервиса для переразвёртки в другом месте.  

### Дополнительно

Для **преддиагностики** предлагается наличие "галочки" включения/выключения тестов в окне деплоя и дополнительно активна она или нет определять по наличию диага для данного сервиса. И в целом оптимальнее запрашивать у диага то, какие параметры нужны для предпроверки, а не помечать их.  

Этот **entry** предполагается динамическим, как минимум из-за наличия комбинаций приложений и нескольких режимов работы. Например samba+внутренний dns и samba+bind. Сопровождение двух таких конфигураций в разных сущностях бессмысленно так как там отличия минимальны.

Информацию о том с какими параметрами был развёрнут сервис предлагается хранить в dconf. Однако при отображении  текущего статуса информацию следует парсить из файлов конфигурации, так как администраторы спокойно могут их изменить руками и dconf в данном случае будет служить архивом того как оно было изначально.

**Остаётся вопрос** определения того развёрнут ли уже сервис и если да, то в каком режиме, на каких портах, изменялось ли расположение конфигов и прочее. Для разных сервисов тут будт своя, местами, достаточно сложная эвристика.  
